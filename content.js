/**
 * @fileoverview Content script entry for Superpowers; handles autopilot
 * actions, timeline parsing, and UI prompts on x.com pages.
 */
(()=>{"use strict";(()=>{function e(e){return new Promise((t=>{console.log(`Sleeping ${e} ms ...`),setTimeout((()=>t()),e)}))}const t="SuperpowersForTwitterSuspendedAutopilotActionTypes";const n=()=>{const e=sessionStorage.getItem(t);return"string"!=typeof e?[]:JSON.parse(e)};function i(){if("object"!=typeof wi)return;const e=n().concat(wi.type);sessionStorage.setItem(t,JSON.stringify(e))}const o=[{title:"Superpowers for LinkedIn",text:"Mass connect, mass withdraw invitation and mass view profile on LinkedIn with powerful options.",action:{text:"Learn more",url:"https://www.clemensteichmann.com/superpowers-for-linkedin"}},{title:"Superpowers for Instagram",text:"Mass follow, mass unfollow and mass like on Instagram with powerful options.",action:{text:"Learn more",url:"https://www.clemensteichmann.com/superpowers-for-instagram"}},{title:"Superpowers for Twitter PRO",text:"Unlimited and ad-free",action:{text:"Get PRO",url:"https://www.clemensteichmann.com/superpowers-for-twitter/pro"}}],l=({text:e,title:t,action:n})=>`\n    <div class="sft-ad animated fadeInRight">\n      <div class="sft-ad__title">${t}</div>\n      <div class="sft-ad__text">${e}</div>\n      <a class="sft-ad__action" href="${n.url}" target="_blank">${n.text}</a>\n    </div>\n  `,a=document.createElement("div");function s(){a.style.display="none"}function r(){a.innerHTML=function(e,t){t=null==t?1:t;const n=null==e?0:e.length;if(!n||t<1)return[];t=t>n?n:t;let i=-1;const o=n-1,l=[...e];for(;++i<t;){const e=i+Math.floor(Math.random()*(o-i+1)),t=l[e];l[e]=l[i],l[i]=t}return l.slice(0,t)}(o,3).map((e=>l(e))).join(""),a.style.display="flex"}a.classList.add("sft-ads"),document.body.appendChild(a);const c=e=>{if(e<60)return String(e);const t=e/60/60,n=Math.floor(t),i=60*(t-n),o=Math.floor(i),l=60*(i-o),a=Math.round(l);let s;return n>0?(s=String(n),s+=":",s+=String(o).padStart(2,0)):s=String(o),s+=":",s+=String(a).padStart(2,0),s};const u=document.createElement("div");let w;function f(){w="follow"}function d(){w="unfollow"}function m(){w="like"}function p(){w="retweet"}function y(){w="unretweet"}function g(){w="unlike"}function k(e){u.innerHTML=`Continuing autopilot in ${function(e){const t=e%1e3;let n=c((e-t)/1e3);return n+=".",n+=String(t).padStart(3,0),n}(e)} ...`}function b(e,...t){for(let n=0;n<t.length;n++)if(void 0===(e=e[t[n]]))return;return e}function F(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];throw`${t} missing on ${JSON.stringify(e)}`}u.classList.add("sft-status-bar__label");let h;document.querySelectorAll("script").forEach((e=>{if(e.innerHTML.includes("__INITIAL_STATE__")){const t=/window.__INITIAL_STATE__=(.*);window.__META_DATA__/,n=e.innerHTML.match(t);h=JSON.parse(n[1])}}));const x=h.session,R=b(h,"entities","users","entities"),L=()=>F(x,"user_id");function S(){const e=R?F(R,L()):F(x,"user");return F(e,"screen_name")}function v(){return location.pathname.toUpperCase()==`/${S()}/following`.toUpperCase()}function T(){return location.pathname.toUpperCase()==`/${S()}/likes`.toUpperCase()}function _(){return location.pathname.toUpperCase()==`/${S()}`.toUpperCase()}function $(){return location.pathname.includes("/lists/")}function M(e){const t=b(e,"data","list","tweets_timeline","timeline","instructions")||b(e,"data","user","result","timeline","timeline","instructions")||b(e,"data","user","result","timeline_v2","timeline","instructions")||b(e,"data","community","community_timeline","timeline","instructions")||b(e,"data","topic_by_rest_id","topic_page","body","timeline","instructions")||b(e,"data","home","home_timeline_urt","instructions")||b(e,"data","search_by_raw_query","search_timeline","timeline","instructions");if(!t)return;const n=[];return t.forEach((e=>{"TimelineAddEntries"==e.type&&e.entries.forEach((e=>{const t=b(e,"content","itemContent","tweet_results","result");if("object"!=typeof t)return;let i;i="TweetWithVisibilityResults"===t.__typename?t.tweet:t,"object"==typeof i&&n.push(i)}))})),n}const I=(e,t,n,i)=>{const o=e();if(o)n(o);else{if("number"==typeof t){if(t<=0)return void i("time limit exceeded");t-=100}setTimeout((()=>I(e,t,n,i)),100)}};function E(e,t){return new Promise(((n,i)=>{I(e,t,n,i)}))}let A;const C=async({fromIndex:t=0,getList:n,getFocusableEl:i})=>{if(!Un){Gn(),console.log("Scan list for usable index ...");for(let e=t;e<n().length;e++){if(i(n()[e]))return e}return window.scrollBy(0,300),await e(500),await C({fromIndex:t,getList:n,getFocusableEl:i})}},D=async({callback:e,getList:t,getFocusableEl:n,index:i})=>{if(Un)return;if(Gn(),Pn)return void await q({callback:e,getList:t,getFocusableEl:n,index:i,milliseconds:500});if(void 0===t())return;const o=t()[i];if(void 0===o)await q({callback:e,getList:t,getFocusableEl:n,index:i,milliseconds:100});else{try{o.focusableEl=await E((()=>n(o)),2e3),A=window.scrollY}catch(o){console.log(o),A&&window.scrollTo(0,A);const l=await C({fromIndex:i+1,getList:t,getFocusableEl:n});return void await D({callback:e,getList:t,getFocusableEl:n,index:l})}o.focusableEl.focus(),await e(o,i),await D({callback:e,getList:t,getFocusableEl:n,index:i+1})}},q=async({callback:t,getList:n,getFocusableEl:i,index:o,milliseconds:l})=>{await e(l),await D({callback:t,getList:n,getFocusableEl:i,index:o})};async function U({callback:e,getFocusableEl:t,getList:n}){A=void 0;const i=await C({getList:n,getFocusableEl:t});await D({callback:e,getList:n,getFocusableEl:t,index:i})}const P=e=>F(e.core,"screen_name");function j(e){return e.legacy.followers_count}function B(e){return 1==e.relationship_perspectives.followed_by}function W(e){const t=e.legacy.followers_count;if("number"!=typeof t)return;const n=e.legacy.friends_count;return"number"==typeof n?t/n:void 0}function O(e){return e.legacy.friends_count}function V(e){return F(e,"rest_id")}function G(e){return 1==e.privacy.protected}function N(e){return 1==e.is_blue_verified}function X(e){return F(e.legacy,"description")}function H(e){return`/${P(e)}`}const J=e=>F(e,"rest_id");function Q(e){return F(e.legacy,"lang")}function K(e){return F(e.legacy,"favorite_count")}function Y(e){return 1==e.legacy.favorited}function z(e){return"string"==typeof e.legacy.in_reply_to_status_id_str}function Z(e){return"object"==typeof e.legacy.retweeted_status_result}function ee(e){return"string"==typeof e.legacy.quoted_status_id_str}function te(e){return 1==e.legacy.retweeted}function ne(e){return b(e.legacy,"retweeted_status_result","result","rest_id")||J(e)}function ie(e){return e.legacy.full_text}const oe=e=>e.core.user_results.result;function le(e){return V(oe(e))}function ae(e){const t=`[data-testid="tweet"] a[href$="/status/${ne(e)}"][role="link"]`;return console.log(`Querying tweet link with ${t}`),document.querySelector(t)}function se(e){return e.focusableEl.closest('[data-testid="tweet"]').lastElementChild}window.addEventListener("message",(e=>{e.data.origin&&"string"==typeof e.data.response&&e.data.url&&e.data.status&&we(e.data)}));const re=document.createElement("script");re.type="text/javascript",re.src=chrome.runtime.getURL("app.js"),document.documentElement.appendChild(re);const ce={};function ue(e,t){ce[e]=ce[e]||[],ce[e].push(t)}const we=({body:e,origin:t,response:n,status:i,url:o})=>{Object.keys(ce).forEach((l=>{if(!o.includes(l))return;let a={};if(n.length>0)try{a=JSON.parse(n)}catch(e){console.error(e)}ce[l].forEach((n=>n({body:e,origin:t,parsedResponse:a,status:i,url:o})))}))},fe={};ue("/Likes",(({origin:e,parsedResponse:t})=>((e,t)=>{!1!==Array.isArray(t)&&0!==t.length&&(fe[e]?fe[e]=fe[e].concat(t):fe[e]=t)})(e,M(t))));const de=()=>fe[location.href.toUpperCase()];async function me(e){await U({callback:e,getFocusableEl:ae,getList:de})}function pe(e){const t=`[data-testid="${V(e)}-follow"]`;return console.log(`Querying follow button of ${P(e)} with ${t}`),document.querySelector(t)}function ye(e){const t=`[data-testid="cellInnerDiv"] a[href="${H(e)}"][role="link"]`,n=`[data-testid="UserCell"] a[href="${H(e)}"][role="link"]`;return console.log(`Querying profile link of ${P(e)} with ${t}`),document.querySelector(t)||document.querySelector(n)}function ge(e){const t=`[aria-modal="true"] [data-testid="UserCell"] a[href="${H(e)}"][role="link"]:not([dir])`;return console.log(`Querying profile link of ${P(e)} with ${t}`),document.querySelector(t)}function ke(e){return e.focusableEl.closest('[data-testid="UserCell"]')}const be={},Fe=(e,t)=>{if(!t)return;if(0==t.length)return;void 0===be[e]&&(be[e]=[]);const n=be[e].map((e=>V(e)));t.forEach((t=>{n.includes(V(t))||be[e].push(t)}))},he=(e,t)=>{const n=b(t,"data","user","followers_timeline","timeline","instructions")||b(t,"data","favoriters_timeline","timeline","instructions")||b(t,"data","user","following_timeline","timeline","instructions")||b(t,"data","user","result","timeline","timeline","instructions")||b(t,"data","list","members_timeline","timeline","instructions")||b(t,"data","list","subscribers_timeline","timeline","instructions")||b(t,"data","retweeters_timeline","timeline","instructions")||b(t,"data","search_by_raw_query","search_timeline","timeline","instructions");if(!n)return;const i=[];return n.forEach((t=>{"TimelineAddEntries"==t.type?t.entries.forEach((e=>{const t=b(e,"content","itemContent","user_results","result");"object"==typeof t&&i.push(t)})):"TimelineClearCache"==t.type&&(be[e]=void 0)})),i};ue("/lists/members.json",(({origin:e,parsedResponse:t})=>Fe(e,t.users))),ue("/lists/subscribers.json",(({origin:e,parsedResponse:t})=>Fe(e,t.users))),ue("followers/list.json",(({origin:e,parsedResponse:t})=>Fe(e,t.users))),ue("friends/list.json",(({origin:e,parsedResponse:t})=>Fe(e,t.users))),ue("/Favoriters",(({origin:e,parsedResponse:t})=>Fe(e,he(e,t)))),ue("/Followers",(({origin:e,parsedResponse:t})=>Fe(e,he(e,t)))),ue("/Following",(({origin:e,parsedResponse:t})=>Fe(e,he(e,t)))),ue("/ListMembers",(({origin:e,parsedResponse:t})=>Fe(e,he(e,t)))),ue("/ListSubscribers",(({origin:e,parsedResponse:t})=>Fe(e,he(e,t)))),ue("/Retweeters",(({origin:e,parsedResponse:t})=>Fe(e,he(e,t)))),ue("i/api/graphql",(({origin:e,parsedResponse:t})=>Fe(e,he(e,t))));const xe=()=>be[location.href.toUpperCase()];async function Re(e,t=ye){await U({callback:e,getFocusableEl:t,getList:xe})}const Le={},Se=(e,t)=>{if(!1===Array.isArray(t))return;if(0===t.length)return;Kn()&&(e=_n.toUpperCase()),void 0===Le[e]&&(Le[e]=[]);const n=Le[e].map((e=>J(e)));t.forEach((t=>{n.includes(J(t))||Le[e].push(t)}))};ue("/ListLatestTweetsTimeline",(({origin:e,parsedResponse:t})=>Se(e,M(t)))),ue("/CommunityTweetsTimeline",(({origin:e,parsedResponse:t})=>Se(e,M(t)))),ue("/TopicLandingPage",(({origin:e,parsedResponse:t})=>Se(e,M(t)))),ue("i/api/graphql",(({origin:e,parsedResponse:t})=>Se(e,M(t))));const ve=()=>Le[location.href.toUpperCase()];async function Te(e){await U({callback:e,getFocusableEl:ae,getList:ve})}const _e={};ue("/HomeTimeline",(({origin:e,parsedResponse:t})=>((e,t)=>{if(!1===Array.isArray(t))return;if(0===t.length)return;Kn()&&(e=_n.toUpperCase()),void 0===_e[e]&&(_e[e]=[]);const n=_e[e].map((e=>J(e)));t.forEach((t=>{n.includes(J(t))||_e[e].push(t)}))})(e,M(t))));const $e=()=>_e[location.href.toUpperCase()];async function Me(e){await U({callback:e,getFocusableEl:ae,getList:$e})}const Ie={};ue("/UserTweets",(({origin:e,parsedResponse:t})=>((e,t)=>{if(!1===Array.isArray(t))return;if(0===t.length)return;void 0===Ie[e]&&(Ie[e]=[]);const n=Ie[e].map((e=>J(e)));t.forEach((t=>{n.includes(J(t))||Ie[e].push(t)}))})(e,M(t))));const Ee=()=>Ie[location.href.toUpperCase()];async function Ae(e){await U({callback:e,getFocusableEl:ae,getList:Ee})}const Ce=document.createElement("div");Ce.innerText="Autopilot",Ce.setAttribute("role","button"),Ce.classList.add("sft-button","sft-button--autopilot");const De=()=>{Ce.style.display="none"};async function qe(){"/home"==location.pathname&&!xe()&&await async function(){return"object"==typeof await ti()}()?Ce.style.display="initial":De()}Ce.addEventListener("click",(()=>{De(),mi()}));const Ue=window.indexedDB.open("MassFollowForTwitter",8);let Pe;function je(e,t){Pe.transaction([e],"readwrite").objectStore(e).add(t)}function Be(e,t){return new Promise((n=>{if(!Pe.objectStoreNames.contains(e))return void n(void 0);const i=Pe.transaction([e]).objectStore(e).get(t);i.onsuccess=()=>{n(i.result)}}))}Ue.onupgradeneeded=e=>{Pe=e.target.result,e.oldVersion<3&&Pe.createObjectStore("v2FollowRecord",{keyPath:["creatorId","userId"]}),e.oldVersion<4&&Pe.createObjectStore("retweetRecord",{keyPath:["creatorId","retweetedStatusId"]}),e.oldVersion<5&&Pe.createObjectStore("likeRecord",{keyPath:["creatorId","tweetId"]}),e.oldVersion<6&&Ue.transaction.objectStore("likeRecord").createIndex("tweetUserId","tweetUserId"),e.oldVersion<8&&Ue.transaction.objectStore("v2FollowRecord").createIndex("createdAt",["creatorId","createdAt"])},Ue.onerror=e=>{console.log(e)},Ue.onsuccess=e=>{Pe=e.target.result};const We="likeRecord";function Oe(e){return function(e,t,n){return new Promise((i=>{const o=Pe.transaction([e],"readonly").objectStore(e).index(t).count(IDBKeyRange.only(n));o.onsuccess=()=>{i(o.result)}}))}(We,"tweetUserId",le(e))}function Ve(e){if(!(e=>0===e.trim().length)(e))return e.split(",").map((e=>e.trim()))}function Ge(e,t){return t.includes(Q(e))}function Ne(e){return e[Math.floor(Math.random()*e.length)]}function Xe(e,t){let n=1e3*parseFloat(e);const i=1e3*parseFloat(t),o=[n];for(;n<i;)n+=100,o.push(n);return o}function He(e){return Ne(e)}let Je;const Qe=()=>{try{Je.scrollIntoView({block:"center"})}catch(e){console.error(e)}},Ke=(e,t)=>{const n=document.createElement("div");n.classList.add("sft-notification",`sft-notification--${t}`),n.textContent=e;try{Je.appendChild(n)}catch(e){console.error(e)}Qe()};function Ye(e){console.log(e),Ke(e,"success")}function ze(e){console.log(e),Ke(e,"warning")}function Ze(e){Je=e}function et(e,t){Ze(se(e)),ze(t)}function tt(e,t){Ze(se(e)),Ye(t)}const nt="v2FollowRecord";function it(e){return function(e,t){Pe.transaction([e],"readwrite").objectStore(e).delete(t)}(nt,[L(),e])}function ot(e){return Be(nt,[L(),V(e)])}function lt(e){return Be("followRecord",V(e))}function at(e){if(0===e.length)return;const t=e.split(",").map((e=>e.trim())).filter((e=>e.length));return new RegExp(t.join("|"),"i")}function st(e){return new Promise((t=>{chrome.storage.sync.get(e,(n=>{chrome.storage.local.get(e,(e=>{const i={...n,...e};t(i)}))}))}))}async function rt(e){const t=Object.keys(e),n=await st(t);return{...e,...n}}const ct={likeMaxFollowers:"",likeMaxFollowersFollowingRatio:"",likeMaxFollowing:"",likeMaxTweetLikes:"",likeMinFollowers:"",likeMinFollowing:"",likeMinFollowersFollowingRatio:"",likeMinTweetLikes:"",likeIntervalMax:8,likeIntervalMin:4,likeLanguageWhitelist:"",likeLimit:1e3,likePauseWhenUnableToLike:10,likeSkipFollowed:!1,likeSkipReplies:!1,likeSkipRetweets:!1,likeSkipRetweetsWithComment:!1,likeSkipLikedXTweetsFromUser:"",likeTweetTextBlacklist:""},ut=()=>rt(ct),wt=async()=>{const e=await ut();return e.languageWhitelist=Ve(e.likeLanguageWhitelist),e.intervalDurationRange=Xe(e.likeIntervalMin,e.likeIntervalMax),e.skipLikedXTweetsFromUser=parseInt(e.likeSkipLikedXTweetsFromUser),e.tweetTextBlacklist=at(e.likeTweetTextBlacklist),e.maxFollowing=parseInt(e.likeMaxFollowing),e.minFollowing=parseInt(e.likeMinFollowing),e.maxFollowers=parseInt(e.likeMaxFollowers),e.minFollowers=parseInt(e.likeMinFollowers),e.maxFollowersFollowingRatio=parseFloat(e.likeMaxFollowersFollowingRatio),e.minFollowersFollowingRatio=parseFloat(e.likeMinFollowersFollowingRatio),e.maxTweetLikes=parseInt(e.likeMaxTweetLikes),e.minTweetLikes=parseInt(e.likeMinTweetLikes),e},ft=async(e,t)=>{const n=await async function(e,t){if(Y(e))return"already liked";if(t.minTweetLikes){const n=K(e);if(n<t.minTweetLikes)return`${n} Tweet likes, but ${t.minTweetLikes} minimum required`}if(t.maxTweetLikes){const n=K(e);if(n>t.maxTweetLikes)return`${n} Tweet likes, but ${t.maxTweetLikes} maximum required`}if(t.languageWhitelist&&!Ge(e,t.languageWhitelist))return`language "${Q(e)}" not whitelisted`;if(t.tweetTextBlacklist instanceof RegExp&&ie(e)){const n=ie(e).match(t.tweetTextBlacklist);if(n)return`${n.join()} found in Tweet text, but is blacklisted`}if(t.likeSkipReplies&&z(e))return"is reply";if(t.likeSkipRetweets&&Z(e))return"is Retweet";if(t.likeSkipRetweetsWithComment&&ee(e))return"is Retweet with comment";if(t.minFollowing){const n=O(oe(e));if("number"==typeof n&&n<t.minFollowing)return`${n} following, but ${t.minFollowing} minimum required`}if(t.maxFollowing){const n=O(oe(e));if("number"==typeof n&&n>t.maxFollowing)return`${n} following, but ${t.maxFollowing} maximum required`}if(t.minFollowers){const n=j(oe(e));if("number"==typeof n&&n<t.minFollowers)return`${n} followers, but ${t.minFollowers} minimum required`}if(t.maxFollowers){const n=j(oe(e));if("number"==typeof n&&n>t.maxFollowers)return`${n} followers, but ${t.maxFollowers} maximum required`}if(t.minFollowersFollowingRatio){const n=W(oe(e));if(n&&n<t.minFollowersFollowingRatio)return`${n.toFixed(2)} followers/following ratio, but ${t.minFollowersFollowingRatio} minimum required`}if(t.maxFollowersFollowingRatio){const n=W(oe(e));if(n&&n>=t.maxFollowersFollowingRatio)return`${n.toFixed(2)} followers/following ratio, but ${t.maxFollowersFollowingRatio} maximum required`}if(t.likeSkipFollowed){const t=oe(e);if(await ot(t))return"already followed once";if(await lt(t))return"already followed once"}if(t.skipLikedXTweetsFromUser){const n=await Oe(e);if("number"==typeof n&&n>=t.skipLikedXTweetsFromUser)return`already liked ${n} Tweet(s) from user`}return!0}(e,t);if(1==n){const n=function(e){return e.focusableEl.closest('[data-testid="tweet"]').querySelector('[data-testid="like"]')}(e);if(!n)return!1;n.click(),function(e){const t={createdAt:Date.now(),creatorId:L(),tweetId:J(e),tweetUserId:le(e)};je(We,t)}(e),Qn(),tt(e,"successfully liked");const i=He(t.intervalDurationRange);await Vn(i),Qe()}else n&&et(e,n)};async function dt(e,t){const n=await wt();await Bn(),n.likeLimit&&Hn(n.likeLimit),e&&Hn(e),t&&On(t),Nn(n.likePauseWhenUnableToLike),ve()?await Te((async e=>{await ft(e,n)})):$e()?(delete n.likeSkipFollowed,delete n.likeSkipLikedXTweetsFromUser,delete n.maxFollowing,delete n.minFollowing,delete n.maxFollowers,delete n.minFollowers,delete n.maxFollowersFollowingRatio,delete n.minFollowersFollowingRatio,await Me((async e=>{await ft(e,n)}))):de()?await me((async e=>{await ft(e,n)})):Ee()&&(delete n.maxFollowing,delete n.minFollowing,delete n.maxFollowers,delete n.minFollowers,delete n.maxFollowersFollowingRatio,delete n.minFollowersFollowingRatio,await Ae((async e=>{await ft(e,n)})))}const mt=document.createElement("div");mt.innerText="Like all",mt.setAttribute("role","button"),mt.classList.add("sft-button","sft-button--like");const pt=()=>{mt.style.display="none"};mt.addEventListener("click",(async()=>{m(),De(),qt(),Rt(),pt(),await dt()}));const yt="retweetRecord";const gt={retweetIntervalMax:8,retweetIntervalMin:4,retweetLanguageWhitelist:"",retweetLimit:1e3,retweetPauseWhenUnableToRetweet:10,retweetSkipFollowed:!1,retweetSkipReplies:!1,retweetSkipRetweets:!1,retweetSkipRetweetsWithComment:!1,retweetTweetTextBlacklist:""},kt=()=>rt(gt),bt=async()=>{const e=await kt();return e.languageWhitelist=Ve(e.retweetLanguageWhitelist),e.intervalDurationRange=Xe(e.retweetIntervalMin,e.retweetIntervalMax),e.tweetTextBlacklist=at(e.retweetTweetTextBlacklist),e},Ft=async(e,t)=>{const n=await async function(e,t){if(te(e))return"already retweeted";if(t.languageWhitelist&&!Ge(e,t.languageWhitelist))return`language "${Q(e)}" not whitelisted`;if(t.tweetTextBlacklist instanceof RegExp&&ie(e)){const n=ie(e).match(t.tweetTextBlacklist);if(n)return`${n.join()} found in Tweet text, but is blacklisted`}if(t.retweetSkipFollowed){const t=oe(e);if(await ot(t))return"already followed once";if(await lt(t))return"already followed once"}return t.retweetSkipReplies&&z(e)?"is reply":t.retweetSkipRetweets&&Z(e)?"is Retweet":!t.retweetSkipRetweetsWithComment||!ee(e)||"is Retweet with comment"}(e,t);if(1==n){const n=function(e){return e.focusableEl.closest('[data-testid="tweet"]').querySelector('[data-testid="retweet"]')}(e);if(!n)return!1;Jn("/compose/tweet"),n.click();(await E((()=>document.querySelector('div[data-testid="retweetConfirm"]')||document.querySelector('[aria-modal="true"] [data-testid="toolBar"] [data-testid="tweetButton"]')),9999)).click(),function(e){const t=ne(e),n={createdAt:Date.now(),creatorId:L(),retweetedStatusId:t};je(yt,n)}(e),Qn(),tt(e,"successfully retweeted");const i=He(t.intervalDurationRange);await Vn(i),Qe()}else n&&et(e,n)};async function ht(e,t){const n=await bt();await Bn(),n.retweetLimit&&Hn(n.retweetLimit),e&&Hn(e),t&&On(t),Nn(n.retweetPauseWhenUnableToRetweet),ve()?await Te((async e=>{await Ft(e,n)})):$e()?(delete n.retweetSkipFollowed,await Me((async e=>{await Ft(e,n)}))):Ee()&&await Ae((async e=>{await Ft(e,n)}))}const xt=document.createElement("div");xt.innerText="Retweet all",xt.setAttribute("role","button"),xt.classList.add("sft-button","sft-button--retweet");const Rt=()=>{xt.style.display="none"};function Lt(){ve()&&!location.pathname.includes("/communities/")||$e()||Ee()&&!_()?xt.style.display="initial":Rt()}function St(e){return e.split(",").map((e=>e.trim().toUpperCase()))}function vt(e,t){return t.includes(`@${P(e).toUpperCase()}`)}function Tt(e){!function(e){const t={createdAt:Date.now(),creatorId:L(),userId:V(e)};je(nt,t)}(e),Qn()}async function _t(e,t){if(!function(e){return P(e)==S()}(e)&&function(e){return 1!=e.relationship_perspectives.following&&1!=e.legacy.follow_request_sent}(e)){if(function(e){return 1==e.relationship_perspectives.blocked_by}(e))return"is blocking you";if(t.followBioRequired&&function(e){return""===F(e.legacy,"description")}(e))return"has no biography";if(t.followSkipVerified&&N(e))return"is verified";if(vt(e,t.blacklist))return"is blacklisted";if(t.followProfileImageRequired&&function(e){return 1==e.legacy.default_profile_image}(e))return"has default profile image";if(t.followSkipProtected&&G(e))return"is protected";if(t.followProtectedRequired&&!G(e))return"is not protected";if(t.followSkipFollower&&B(e))return"is following you";if(t.minFollowing){const n=O(e);if("number"==typeof n&&n<t.minFollowing)return`${n} following, but ${t.minFollowing} minimum required`}if(t.maxFollowing){const n=O(e);if("number"==typeof n&&n>t.maxFollowing)return`${n} following, but ${t.maxFollowing} maximum required`}if(t.minFollowers){const n=j(e);if("number"==typeof n&&n<t.minFollowers)return`${n} followers, but ${t.minFollowers} minimum required`}if(t.maxFollowers){const n=j(e);if("number"==typeof n&&n>t.maxFollowers)return`${n} followers, but ${t.maxFollowers} maximum required`}if(t.minFollowersFollowingRatio){const n=W(e);if(n&&n<t.minFollowersFollowingRatio)return`${n.toFixed(2)} followers/following ratio, but ${t.minFollowersFollowingRatio} minimum required`}if(t.maxFollowersFollowingRatio){const n=W(e);if(n&&n>=t.maxFollowersFollowingRatio)return`${n.toFixed(2)} followers/following ratio, but ${t.maxFollowersFollowingRatio} maximum required`}if(t.bioBlacklist instanceof RegExp){const n=X(e).match(t.bioBlacklist);if(n)return`${n.join()} found in bio, but is blacklisted`}if(t.bioWhitelist instanceof RegExp){const n=X(e);if(!1===t.bioWhitelist.test(n))return"no whitelisted word found in bio"}if(t.followSkipFollowed){if(await ot(e))return"already followed once";if(await lt(e))return"already followed once"}return!0}}async function $t(e,t){let n;const i=oe(e);if(n=t.tweetLanguageWhitelist&&!Ge(e,t.tweetLanguageWhitelist)?`language "${Q(e)}" not whitelisted`:await _t(i,t),1==n){let n;Jn(H(i)),function(e){const t=`a[href="${H(oe(e))}"][role="link"]`;return e.focusableEl.closest('[data-testid="tweet"]').querySelector(t)}(e).click();try{n=await E((()=>pe(i)),2e3)}catch(e){console.log(e)}if(n&&n.click(),window.history.back(),await E((()=>Yn())),e.focusableEl=await E((()=>ae(e))),e.focusableEl.focus(),Ze(se(e)),!n)return ze("follow button not found");Tt(i),Ye("successfully followed");const o=He(t.intervalDurationRange);await Vn(o)}else Ze(se(e)),n&&(ze(n),await Vn(500))}xt.addEventListener("click",(async()=>{p(),qt(),Rt(),pt(),await ht()}));const Mt=async e=>{if(!Un){for(let t=e;t>=0;t--){const n=xe()[t];if(n.focusableEl=ge(n),n.focusableEl){if(n.focusableEl.scrollIntoView(),t===e)return;break}}await Vn(40),await Mt(e)}};const It={followBlacklist:"@username1,@username2",followBioBlacklist:"",followBioRequired:!1,followBioWhitelist:"",followDailyLimit:"",followIntervalMax:8,followIntervalMin:4,followLimit:400,followMaxFollowers:"",followMaxFollowersFollowingRatio:"",followMaxFollowing:"",followMinFollowers:"",followMinFollowing:"",followMinFollowersFollowingRatio:"",followPauseAfterSkipMax:"",followPauseAfterSkipMin:"",followPauseWhenTwitterLimitExceeded:5,followProfileImageRequired:!1,followProtectedRequired:!1,followSkipFollowed:!0,followSkipFollower:!1,followSkipProtected:!1,followSkipVerified:!1,followTweetLanguageWhitelist:""},Et=()=>rt(It),At=async()=>{const e=await Et();return e.blacklist=St(e.followBlacklist),e.bioBlacklist=at(e.followBioBlacklist),e.bioWhitelist=at(e.followBioWhitelist),e.tweetLanguageWhitelist=Ve(e.followTweetLanguageWhitelist),e.intervalDurationRange=Xe(e.followIntervalMin,e.followIntervalMax),e.maxFollowing=parseInt(e.followMaxFollowing),e.minFollowing=parseInt(e.followMinFollowing),e.maxFollowers=parseInt(e.followMaxFollowers),e.minFollowers=parseInt(e.followMinFollowers),e.maxFollowersFollowingRatio=parseFloat(e.followMaxFollowersFollowingRatio),e.minFollowersFollowingRatio=parseFloat(e.followMinFollowersFollowingRatio),e.followPauseAfterSkipMin&&e.followPauseAfterSkipMax&&(e.pauseAfterSkipRange=Xe(e.followPauseAfterSkipMin,e.followPauseAfterSkipMax)),e};async function Ct(e,t){const n=await At();var o;await Bn(),n.followLimit&&Hn(n.followLimit),e&&Hn(e),n.followDailyLimit&&(o=await async function(){const e=Pe.transaction([nt],"readonly").objectStore(nt).index("createdAt"),t=IDBKeyRange.bound([L(),Date.now()-864e5],[L(),Date.now()]);let n=0;return new Promise((i=>{e.openCursor(t).onsuccess=e=>{const t=e.target.result;t?(n+=1,t.continue()):i(n)}}))}(),In=o,function(e){$n=e,In>=$n&&(Un=!0,i(),hn())}(n.followDailyLimit)),t&&On(t),Nn(n.followPauseWhenTwitterLimitExceeded),$()&&xe()?await async function(e){await Re((async(t,n)=>{const i=await _t(t,e);if(1==i){let i=pe(t);if(i)i.click(),Tt(t);else{Jn(H(t)),t.focusableEl.click();try{i=await E((()=>pe(t)),4e3)}catch(e){console.log(e)}i&&(i.click(),Tt(t)),window.history.back(),await E((()=>Yn())),await Mt(n)}if(Ze(ke(t)),!i)return ze("follow button not found");Ye("successfully followed");const o=He(e.intervalDurationRange);await Vn(o)}else Ze(ke(t)),i&&(ze(i),await Vn(500))}),ge)}(n):ve()?await async function(e){await Te((async t=>{await $t(t,e)}))}(n):de()?await async function(e){await me((async t=>{await $t(t,e)}))}(n):await async function(e){await Re((async t=>{const n=await _t(t,e);if(Ze(ke(t)),1==n){const n=pe(t);if(!n)return ze("follow button not found");n.click(),Tt(t),Ye("successfully followed");const i=He(e.intervalDurationRange);await Vn(i)}else if(n&&ze(n),e.pauseAfterSkipRange){const t=He(e.pauseAfterSkipRange);await Vn(t)}}))}(n)}const Dt=document.createElement("div");Dt.innerText="Follow all",Dt.setAttribute("role","button"),Dt.classList.add("sft-button","sft-button--follow");const qt=()=>{Dt.style.display="none"};Dt.addEventListener("click",(async()=>{f(),qt(),pt(),Rt(),await Ct()}));const Ut=864e5;function Pt(e){return(Date.now()-e)/Ut}const jt=(e,t,n)=>n.indexOf(e)==t,Bt=(e,t)=>{const n=[];if(t.followingLessThan){if(O(e)<t.followingLessThan)return!0;n.push(`${O(e)} Following`)}if(t.followingGreaterThan){if(O(e)>t.followingGreaterThan)return!0;n.push(`${O(e)} Following`)}if(t.followersLessThan){if(j(e)<t.followersLessThan)return!0;n.push(`${j(e)} Followers`)}if(t.followersGreaterThan){if(j(e)>t.followersGreaterThan)return!0;n.push(`${j(e)} Followers`)}return 0===n.length||n.filter(jt).join(", ")};async function Wt(e,t){if(function(e){return F(e.relationship_perspectives,"following")}(e)){if(t.unfollowSkipFollower&&B(e))return"is following you";if(t.unfollowSkipVerified&&N(e))return"is verified";if(vt(e,t.blacklist))return"is blacklisted";if(t.bioBlacklist instanceof RegExp){const n=X(e).match(t.bioBlacklist);if(n)return`${n.join()} found in bio, but is blacklisted`}if(t.unfollowMassFollowedRequired||t.minDaysFollowed){const n=await ot(e),i=await lt(e);if(t.unfollowMassFollowedRequired&&!n&&!i)return"has not been mass followed";if(t.minDaysFollowed&&n){const e=Pt(n.createdAt);if(e<t.minDaysFollowed)return`${e.toFixed(2)} days followed, but ${t.minDaysFollowed} days minimum required`}if(t.minDaysFollowed&&i){const e=Pt(i.createdAt);if(e<t.minDaysFollowed)return`${e} days followed, but ${t.minDaysFollowed} days minimum required`}}return Bt(e,t)}}const Ot={unfollowBlacklist:"@username1,@username2",unfollowBioBlacklist:"",unfollowFollowersLessThan:"",unfollowFollowersGreaterThan:"",unfollowFollowingLessThan:"",unfollowFollowingGreaterThan:"",unfollowIntervalMax:8,unfollowIntervalMin:4,unfollowLimit:"",unfollowMassFollowedRequired:!1,unfollowMinDaysFollowed:2,unfollowPauseAfterSkipMax:"",unfollowPauseAfterSkipMin:"",unfollowSkipFollower:!0,unfollowSkipVerified:!1},Vt=()=>rt(Ot),Gt=()=>document.querySelector('[data-testid="confirmationSheetConfirm"]'),Nt=async()=>{const e=await Vt();return e.blacklist=St(e.unfollowBlacklist),e.bioBlacklist=at(e.unfollowBioBlacklist),e.followingLessThan=parseInt(e.unfollowFollowingLessThan),e.followingGreaterThan=parseInt(e.unfollowFollowingGreaterThan),e.followersLessThan=parseInt(e.unfollowFollowersLessThan),e.followersGreaterThan=parseInt(e.unfollowFollowersGreaterThan),e.intervalDurationRange=Xe(e.unfollowIntervalMin,e.unfollowIntervalMax),e.minDaysFollowed=parseFloat(e.unfollowMinDaysFollowed),e.unfollowPauseAfterSkipMin&&e.unfollowPauseAfterSkipMax&&(e.pauseAfterSkipRange=Xe(e.unfollowPauseAfterSkipMin,e.unfollowPauseAfterSkipMax)),e};async function Xt(e,t){const n=await Nt();await Bn(),n.unfollowLimit&&Hn(n.unfollowLimit),e&&Hn(e),t&&On(t),await Re((async e=>{Ze(ke(e));const t=await Wt(e,n);if(1==t){const t=function(e){const t=`[data-testid="${V(e)}-unfollow"]`;return console.log(`Querying unfollow button of ${P(e)} with ${t}`),document.querySelector(t)}(e);if(!t)return ze("unfollow button not found");t.click();(await E((()=>Gt()),1e3)).click(),Qn(),Ye("successfully unfollowed");const i=He(n.intervalDurationRange);await Vn(i)}else if(t&&ze(t),n.pauseAfterSkipRange){const e=He(n.pauseAfterSkipRange);await Vn(e)}}))}const Ht=document.createElement("div");Ht.innerText="Unfollow all",Ht.setAttribute("role","button"),Ht.classList.add("sft-button","sft-button--unfollow");const Jt=()=>{Ht.style.display="none"};async function Qt(e,t){if(Y(e)){if(t.unlikeMassLikedRequired||t.minDaysSinceLike){const n=await function(e){return Be(We,[L(),J(e)])}(e);if(t.unlikeMassLikedRequired&&!n)return"has not been mass liked";if(t.minDaysSinceLike&&n){const e=Pt(n.createdAt);if(e<t.minDaysSinceLike)return`${e.toFixed(2)} days since like, but ${t.minDaysSinceLike} minimum required`}}return!0}}Ht.addEventListener("click",(async()=>{d(),Jt(),await Xt()}));const Kt={unlikeIntervalMax:8,unlikeIntervalMin:4,unlikeLimit:"",unlikeMassLikedRequired:!1,unlikeMinDaysSinceLike:2};const Yt=async()=>{const e=await rt(Kt);return e.intervalDurationRange=Xe(e.unlikeIntervalMin,e.unlikeIntervalMax),e.minDaysSinceLike=parseFloat(e.unlikeMinDaysSinceLike),e};async function zt(e,t){const n=await Yt();await Bn(),n.unlikeLimit&&Hn(n.unlikeLimit),e&&Hn(e),t&&On(t),await me((async e=>{const t=await Qt(e,n);if(1==t){const t=function(e){return e.focusableEl.closest('[data-testid="tweet"]').querySelector('[data-testid="unlike"]')}(e);if(!t)return!1;t.click(),Qn(),tt(e,"successfully unliked");const i=He(n.intervalDurationRange);await Vn(i)}else t&&(et(e,t),await Vn(500))}))}const Zt=document.createElement("div");Zt.innerText="Unlike all",Zt.setAttribute("role","button"),Zt.classList.add("sft-button","sft-button--unlike");const en=()=>{Zt.style.display="none"};async function tn(e,t){if(te(e)){if(t.minDaysSinceRetweet){const n=Pt(function(e){const t=F(e.legacy,"created_at");return Date.parse(t)}(e));if(n<t.minDaysSinceRetweet)return`${n.toFixed(2)} days since retweet, but ${t.minDaysSinceRetweet} minimum required`}if(t.unretweetMassRetweetedRequired){const t=await function(e){const t=ne(e);return Be(yt,[L(),t])}(e);if(!t)return"has not been mass retweeted"}return!0}}Zt.addEventListener("click",(async()=>{g(),en(),await zt()}));const nn={unretweetIntervalMax:8,unretweetIntervalMin:4,unretweetLimit:"",unretweetMassRetweetedRequired:!1,unretweetMinDaysSinceRetweet:2};const on=()=>document.querySelector('div[data-testid="unretweetConfirm"]'),ln=async()=>{const e=await rt(nn);return e.intervalDurationRange=Xe(e.unretweetIntervalMin,e.unretweetIntervalMax),e.minDaysSinceRetweet=parseFloat(e.unretweetMinDaysSinceRetweet),e};async function an(e,t){const n=await ln();await Bn(),n.unretweetLimit&&Hn(n.unretweetLimit),e&&Hn(e),t&&On(t),await Ae((async e=>{const t=await tn(e,n);if(1==t){const t=function(e){return e.focusableEl.closest('[data-testid="tweet"]').querySelector('[data-testid="unretweet"]')}(e);if(!t)return!1;t.click();(await E((()=>on()))).click(),Qn(),tt(e,"successfully unretweeted");const i=He(n.intervalDurationRange);await Vn(i)}else t&&(et(e,t),await Vn(500))}))}const sn=document.createElement("div");sn.innerText="Unretweet all",sn.setAttribute("role","button"),sn.classList.add("sft-button","sft-button--unretweet");const rn=()=>{sn.style.display="none"};sn.addEventListener("click",(async()=>{y(),rn(),await an()}));const cn=document.createElement("aside");cn.setAttribute("role","complementary"),cn.classList.add("sft-panel"),document.body.appendChild(cn);const un=()=>{cn.style.display="none"},wn=()=>{cn.style.display="flex"};function fn(){Un||(qe(),xe()&&!v()||ve()&&!$()||de()?Dt.style.display="initial":qt(),ve()||Ee()&&!_()||de()&&!T()||$e()?mt.style.display="initial":pt(),Lt(),xe()&&v()?Ht.style.display="initial":Jt(),de()&&T()?Zt.style.display="initial":en(),Ee()&&_()?sn.style.display="initial":rn(),"initial"==Ce.style.display||"initial"==Dt.style.display||"initial"==mt.style.display||"initial"==xt.style.display||"initial"==Ht.style.display||"initial"==Zt.style.display||"initial"==sn.style.display?(dn.style.display="none",cn.classList.toggle("sft-panel--search-page","/search"==location.pathname),wn()):un())}const dn=document.createElement("div");dn.classList.add("sft-status-bar");const mn=document.createElement("div");mn.innerText="Skip",mn.setAttribute("role","button"),mn.classList.add("sft-status-bar__button"),dn.append(mn),mn.addEventListener("click",(async()=>{mn.style.display="none",await ki()}));const pn=document.createElement("div");pn.innerText="Cancel",pn.setAttribute("role","button"),pn.classList.add("sft-status-bar__button"),dn.append(pn),pn.addEventListener("click",(()=>{jn(),pi(),un(),s()}));const yn=document.createElement("div");function gn(){pn.style.display="initial",yn.style.display="none",mn.style.display="none",function(){switch(w){case"follow":u.textContent=`Twitter follow limit exceeded. Continuing in ${c(Pn)} ...`;break;case"like":u.textContent=`Unable to like. Continuing in ${c(Pn)} ...`;break;case"retweet":u.textContent=`Unable to retweet. Continuing in ${c(Pn)} ...`}}()}function kn(e){pn.style.display="initial",yn.style.display="none",mn.style.display="none",function(e){u.textContent=`Repeating autopilot in ${c(e)} ...`}(e)}function bn(e,t){pn.style.display="initial",yn.style.display="none",mn.style.display="initial",function(e,t){u.textContent=`Autopilot ${e}/${t} ...`}(e,t)}function Fn(){pn.style.display="none",yn.style.display="initial",mn.style.display="none",function(){switch(w){case"follow":u.textContent=`Successfully followed ${Tn} users`;break;case"unfollow":u.textContent=`Successfully unfollowed ${Tn} users`;break;case"like":u.textContent=`Successfully liked ${Tn} Tweets`;break;case"retweet":u.textContent=`Successfully retweeted ${Tn} Tweets`;break;case"unretweet":u.textContent=`Successfully unretweeted ${Tn} Tweets`;break;case"unlike":u.textContent=`Successfully unliked ${Tn} Tweets`}}()}function hn(){pn.style.display="none",yn.style.display="initial",mn.style.display="none",u.textContent=`You have reached the daily limit of ${$n}`,console.log(u.textContent)}function xn(){pn.style.display="initial",yn.style.display="none",mn.style.display=hi()?"initial":"none",function(){const e=Mn?`${Tn}/${Mn}`:Tn;switch(w){case"follow":u.textContent=`Following ${e} ...`;break;case"unfollow":u.textContent=`Unfollowing ${e} ...`;break;case"like":u.textContent=`Liking ${e} ...`;break;case"retweet":u.textContent=`Retweeting ${e} ...`;break;case"unretweet":u.textContent=`Unretweeting ${e} ...`;break;case"unlike":u.textContent=`Unliking ${e} ...`}}()}function Rn(){dn.style.display="flex",qt(),pt(),Rt(),Jt()}function Ln(){return new Promise((e=>{chrome.storage.sync.get(["proActivationKey","proExpiresAt"],(t=>e(t)))}))}function Sn(e){return void 0!==e&&e.proExpiresAt>=Date.now()}yn.innerText="Close",yn.setAttribute("role","button"),yn.classList.add("sft-status-bar__button"),dn.append(yn),yn.addEventListener("click",(()=>un()));const vn=50;let Tn,_n,$n,Mn,In,En,An,Cn,Dn,qn,Un=!1,Pn=!1;function jn(){Un=!0}async function Bn(){Tn=0,In=void 0,$n=void 0,Pn=!1,_n=location.href,En=void 0,An=void 0,Dn=void 0;const e=await Ln();Cn=Sn(e),Cn||(Mn=vn,r()),xn(),Rn()}const Wn=()=>{An=En?Date.now()+En:void 0};function On(e){En=1e3*parseFloat(e),Wn()}async function Vn(t){An&&(An+=t),await e(t)}function Gn(){An&&An<=Date.now()&&(console.log("Idle timeout"),An=void 0,Un=!0)}function Nn(e){qn=60*parseFloat(e)}function Xn(){Pn=qn;const e=setInterval((()=>{Pn-=1,gn(),(Pn<=0||Un)&&(clearInterval(e),Pn=!1)}),1e3)}function Hn(e){(Cn||Mn&&e<Mn)&&(Mn=e),xn()}function Jn(e){Dn=e}function Qn(){Tn+=1,Mn&&Mn<=Tn?(Un=!0,Fn()):$n&&Tn+In>=$n?(Un=!0,i(),hn()):xn(),Wn()}function Kn(){return location.href==_n||(location.pathname==Dn||(Un=!1,!1))}function Yn(){return location.href==_n}const zn="autopilotActions";const Zn=e=>{switch(e.type){case"mass_follow":case"mass_like":case"mass_retweet":return e.url;case"mass_unfollow":case"mass_unlike":case"mass_unretweet":return!0;default:return!1}},ei=async()=>{const e=await async function(){return(await st([zn]))[zn]}();return Array.isArray(e)?e.filter(Zn):[]};async function ti(){return(await ei())[0]}const ni=e=>`https://www.x.com${e}`;const ii="SuperpowersForTwitterAutopilotActionId";async function oi(){const e=sessionStorage.getItem(ii);if("string"!=typeof e)return;sessionStorage.removeItem(ii);const t=await async function(e){return(await ei()).find((t=>t.id===e))}(e);return t}function li(e){switch(sessionStorage.setItem(ii,e.id),e.type){case"mass_follow":case"mass_like":case"mass_retweet":location.href=e.url;break;case"mass_unfollow":location.href=function(e){return ni(`/${e}/following`)}(S());break;case"mass_unlike":location.href=function(e){return ni(`/${e}/likes`)}(S());break;case"mass_unretweet":location.href=function(e){return ni(`/${e}`)}(S())}}const ai=2;async function si(){const e=await async function(){return(await ei()).length}();if(e<=ai)return e;return Sn(await Ln())?e:ai}const ri=async(e,t)=>{try{return await E((()=>(t&&console.log(t),e())),9e3)}catch(e){return console.log(e),console.log("Skipping action ..."),void ki()}};const ci={autopilotPauseAfterActionMax:"",autopilotPauseAfterActionMin:"",autopilotRepeatAfter:60,autopilotRepeatAfterMax:60};function ui(){return rt(ci)}let wi,fi,di=!1;const mi=async()=>{sessionStorage.removeItem(t),wi=await ti(),di=!1;const e=await si();bn(wi.number,e),wn(),Rn(),li(wi)},pi=()=>{di=!0},yi=async()=>{const e=await ui();if(!e.autopilotRepeatAfter)return void pi();if(!Sn(await Ln()))return void pi();let t=((e,t)=>{let n=60*parseFloat(e);const i=60*parseFloat(t),o=[n];for(;n<i;)n+=60,o.push(n);return Ne(o)})(e.autopilotRepeatAfter,e.autopilotRepeatAfterMax);kn(t);const n=setInterval((()=>{di?clearInterval(n):(t-=1,kn(t),t<=0&&(clearInterval(n),mi()))}),1e3)},gi=async t=>{const i=await async function(e){const t=await ei(),i=n(),o=t.filter((t=>t.id==e||!i.includes(t.type))),l=o.map((e=>e.id)),a=l.indexOf(e);if(-1===a)return;return o[a+1]}(wi.id);if(i&&i.number<=t){if(await(async()=>{const{autopilotPauseAfterActionMin:t,autopilotPauseAfterActionMax:n}=await ui();if(!t)return;if(!n)return;let i=He(Xe(t,n));for(;i>0;){if(di)return;o=i,pn.style.display="initial",yn.style.display="none",mn.style.display="none",k(o),i-=100,await e(100)}var o})(),di)return;bn(i.number,t),li(i)}else await yi()};async function ki(){fi=!0,jn();const e=await si();gi(e)}async function bi(){if(wi=await oi(),wi){fi=!1;const e=await si();if(bn(wi.number,e),wn(),Rn(),await async function(e){switch(e.type){case"mass_follow":if(await ri((()=>ve()||xe()||de()),"Find Tweets, users or likes ..."),!hi())return;if(Fi())return;f(),await Ct(e.limit,e.idleTimeout);break;case"mass_like":if(await ri((()=>ve()||de()||Ee()||$e()),"Find Tweets or likes ..."),!hi())return;if(Fi())return;m(),await dt(e.limit,e.idleTimeout);break;case"mass_retweet":if(await ri((()=>ve()||Ee()),"Find Tweets ..."),!hi())return;if(Fi())return;p(),await ht(e.limit,e.idleTimeout);break;case"mass_unfollow":if(await ri((()=>xe()&&v()),"Find users ..."),!hi())return;if(Fi())return;d(),await Xt(e.limit,e.idleTimeout);break;case"mass_unlike":if(await ri((()=>de()&&T()),"Find likes ..."),!hi())return;if(Fi())return;g(),await zt(e.limit,e.idleTimeout);break;case"mass_unretweet":if(await ri((()=>Ee()&&_()),"Find Tweets ..."),!hi())return;if(Fi())return;y(),await an(e.limit,e.idleTimeout)}}(wi),di)return;if(fi)return;await gi(e)}}function Fi(){return!0===fi}function hi(){return"object"==typeof wi&&!1===di}dn.prepend(u),cn.append(dn,Ce,Dt,Ht,xt,mt,sn,Zt),ue("friendships/create.json",(({body:e,parsedResponse:t,status:n})=>{200!=n&&(it(e.match(/&user_id=(\d+)/)[1]),(e=>{if("object"!=typeof e)return;const t=e.errors;if(!Array.isArray(t))return;const n=t[0];return"object"==typeof n?162===n.code:void 0})(t)||(Xn(),hi()?(i(),jn()):Xn()))})),ue("favorites/create.json",(({status:e})=>{200!=e&&(hi()?(i(),jn()):Xn())})),ue("statuses/retweet.json",(({status:e})=>{200!=e&&(hi()?(i(),jn()):Xn())}));(async()=>{await bi(),setInterval((async()=>{hi()||Kn()||(await fn(),s())}),200)})()})()})();